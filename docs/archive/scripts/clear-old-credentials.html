<!DOCTYPE html>
<html>
<head>
    <title>Clear Old API Credentials - ARTLEE</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #dc3545; color: white; border: none; border-radius: 4px; width: 100%; }
        button:hover { background: #c82333; }
        .success { color: green; font-weight: bold; }
        .error { color: red; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        h1 { color: #333; }
        h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 15px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>üîß Clear Old API Credentials - ARTLEE CRM</h1>

    <div class="warning">
        <strong>‚ö†Ô∏è WARNING:</strong> This will clear all stored API credentials from your browser. You will need to re-enter them in Settings > API Configuration after clearing.
    </div>

    <div class="box">
        <h2>Step 1: Clear All Old Credentials</h2>
        <p>Click this button to remove all old API credentials from localStorage, sessionStorage, and memory:</p>
        <button onclick="clearAllCredentials()">
            üóëÔ∏è CLEAR ALL OLD CREDENTIALS
        </button>
        <div id="clearResult" style="margin-top: 20px;"></div>
    </div>

    <div class="box">
        <h2>Step 2: Refresh the Application</h2>
        <p>After clearing credentials, refresh your ARTLEE CRM app to start fresh.</p>
        <button onclick="window.location.href='http://localhost:3007'" style="background: #28a745;">
            üîÑ Open ARTLEE CRM
        </button>
    </div>

    <div class="info">
        <strong>‚ÑπÔ∏è What gets cleared:</strong>
        <ul>
            <li>All localStorage keys starting with "settings_" (user settings)</li>
            <li>Emergency recovery credentials</li>
            <li>Session backup credentials</li>
            <li>Memory backup credentials</li>
            <li>Fallback config credentials</li>
        </ul>
    </div>

    <div class="box">
        <h2>Step 3: Enter Your New Credentials</h2>
        <p>After refreshing, go to <strong>Settings > API Configuration</strong> and enter your new credentials:</p>
        <pre>
API Key: key_3660938283961c067186004a50e3
Call Agent ID: agent_ca2a01536c2e94d0ff4e50df70
SMS Agent ID: (leave blank if not using SMS)
        </pre>
    </div>

    <script>
        function clearAllCredentials() {
            const cleared = [];
            const errors = [];

            try {
                // 1. Clear all settings_* keys from localStorage
                const settingsKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('settings_')) {
                        settingsKeys.push(key);
                    }
                }
                settingsKeys.forEach(key => localStorage.removeItem(key));
                if (settingsKeys.length > 0) {
                    cleared.push(`‚úÖ Cleared ${settingsKeys.length} user settings (settings_*)`);
                }

                // 2. Clear emergency recovery credentials
                if (localStorage.getItem('__emergencyRetellCredentials')) {
                    localStorage.removeItem('__emergencyRetellCredentials');
                    cleared.push('‚úÖ Cleared emergency recovery credentials');
                }

                // 3. Clear fallback config
                if (localStorage.getItem('__fallbackRetellConfig')) {
                    localStorage.removeItem('__fallbackRetellConfig');
                    cleared.push('‚úÖ Cleared fallback config credentials');
                }

                // 4. Clear session backup
                if (sessionStorage.getItem('retell_credentials_backup')) {
                    sessionStorage.removeItem('retell_credentials_backup');
                    cleared.push('‚úÖ Cleared session backup credentials');
                }

                // 5. Clear memory backup
                if (typeof window !== 'undefined' && (window as any).__retellCredentialsBackup) {
                    delete (window as any).__retellCredentialsBackup;
                    cleared.push('‚úÖ Cleared memory backup credentials');
                }

                // 6. Clear any cached API responses
                const apiCacheKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.includes('retell') || key.includes('credential') || key.includes('api'))) {
                        apiCacheKeys.push(key);
                    }
                }
                apiCacheKeys.forEach(key => localStorage.removeItem(key));
                if (apiCacheKeys.length > 0) {
                    cleared.push(`‚úÖ Cleared ${apiCacheKeys.length} API cache keys`);
                }

                // Display success
                if (cleared.length > 0) {
                    document.getElementById('clearResult').innerHTML =
                        '<div class="success">' +
                        '<h3>üéâ CREDENTIALS CLEARED SUCCESSFULLY!</h3>' +
                        '<p>' + cleared.join('<br>') + '</p>' +
                        '<p style="margin-top: 20px; font-size: 16px; color: #28a745;">‚úÖ You can now refresh the app and enter your new credentials!</p>' +
                        '</div>';
                } else {
                    document.getElementById('clearResult').innerHTML =
                        '<div class="info">' +
                        '<h3>‚ÑπÔ∏è No credentials found to clear</h3>' +
                        '<p>Your browser storage is already clean. You can proceed to refresh the app.</p>' +
                        '</div>';
                }

            } catch (error) {
                document.getElementById('clearResult').innerHTML =
                    '<div class="error">' +
                    '<h3>‚ùå Error clearing credentials</h3>' +
                    '<p>' + error.message + '</p>' +
                    '</div>';
            }
        }
    </script>
</body>
</html>
