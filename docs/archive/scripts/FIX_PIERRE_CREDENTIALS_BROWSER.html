<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fix Pierre's Credentials - Browser Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 800px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #2d3748;
      font-size: 28px;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      color: #718096;
      text-align: center;
      margin-bottom: 30px;
    }

    .section {
      background: #f7fafc;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }

    .section h2 {
      color: #2d3748;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .icon {
      width: 24px;
      height: 24px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      flex: 1;
      min-width: 200px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
    }

    button:active {
      transform: translateY(0);
    }

    button.danger {
      background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
      box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
    }

    button.danger:hover {
      box-shadow: 0 6px 16px rgba(245, 101, 101, 0.6);
    }

    button.success {
      background: linear-gradient(135deg, #48bb78 0%, #2f855a 100%);
      box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
    }

    button.success:hover {
      box-shadow: 0 6px 16px rgba(72, 187, 120, 0.6);
    }

    .output {
      background: #2d3748;
      color: #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .output.hidden {
      display: none;
    }

    .credentials {
      background: #edf2f7;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }

    .credential-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #cbd5e0;
    }

    .credential-row:last-child {
      border-bottom: none;
    }

    .credential-label {
      font-weight: 600;
      color: #4a5568;
    }

    .credential-value {
      font-family: 'Courier New', monospace;
      color: #2d3748;
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 13px;
    }

    .status {
      padding: 10px 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-weight: 600;
      text-align: center;
    }

    .status.success {
      background: #c6f6d5;
      color: #22543d;
      border: 2px solid #48bb78;
    }

    .status.error {
      background: #fed7d7;
      color: #742a2a;
      border: 2px solid #f56565;
    }

    .status.warning {
      background: #feebc8;
      color: #744210;
      border: 2px solid #ed8936;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Fix Pierre's Credentials</h1>
    <p class="subtitle">Browser-based credential repair tool for pierre@phaetonai.com</p>

    <!-- Step 1: Diagnose -->
    <div class="section">
      <h2>
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
        </svg>
        Step 1: Diagnose Current State
      </h2>
      <div class="button-group">
        <button onclick="diagnoseCredentials()">üîç Check Current Credentials</button>
      </div>
      <div id="diagnoseOutput" class="output hidden"></div>
    </div>

    <!-- Step 2: Clear Wrong Data -->
    <div class="section">
      <h2>
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        Step 2: Clear Wrong Credentials
      </h2>
      <div class="button-group">
        <button class="danger" onclick="clearCredentials()">üóëÔ∏è Clear localStorage Credentials</button>
      </div>
      <div id="clearOutput" class="output hidden"></div>
    </div>

    <!-- Step 3: Apply Correct Credentials -->
    <div class="section">
      <h2>
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Step 3: Apply Correct Credentials
      </h2>
      <div class="credentials">
        <div class="credential-row">
          <span class="credential-label">API Key:</span>
          <span class="credential-value">key_cda2021a151b9a84e721299f2c04</span>
        </div>
        <div class="credential-row">
          <span class="credential-label">Call Agent ID:</span>
          <span class="credential-value">agent_544379e4fc2a465b7e8eb6fd19</span>
        </div>
        <div class="credential-row">
          <span class="credential-label">SMS Agent ID:</span>
          <span class="credential-value">(empty)</span>
        </div>
        <div class="credential-row">
          <span class="credential-label">Tenant ID:</span>
          <span class="credential-value">phaeton_ai</span>
        </div>
      </div>
      <div class="button-group">
        <button class="success" onclick="applyCorrectCredentials()">‚úÖ Apply Correct Credentials</button>
      </div>
      <div id="applyOutput" class="output hidden"></div>
    </div>

    <!-- Step 4: Verify -->
    <div class="section">
      <h2>
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
        </svg>
        Step 4: Verify Fix
      </h2>
      <div class="button-group">
        <button onclick="verifyFix()">üîç Verify Credentials Are Correct</button>
        <button class="success" onclick="reloadPage()">üîÑ Reload Page</button>
      </div>
      <div id="verifyOutput" class="output hidden"></div>
    </div>
  </div>

  <script>
    const USER_ID = '166b5086-5ec5-49f3-9eff-68f75d0c8e79'
    const CORRECT_CREDENTIALS = {
      retellApiKey: 'key_cda2021a151b9a84e721299f2c04',
      callAgentId: 'agent_544379e4fc2a465b7e8eb6fd19',
      smsAgentId: '',
      tenantId: 'phaeton_ai'
    }

    function diagnoseCredentials() {
      const output = document.getElementById('diagnoseOutput')
      output.classList.remove('hidden')

      let result = 'üîç DIAGNOSIS REPORT\n'
      result += '=' .repeat(60) + '\n\n'

      try {
        // Check currentUser
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}')
        result += '‚úÖ currentUser exists\n'
        result += `   User ID: ${currentUser.id || 'MISSING'}\n`
        result += `   Email: ${currentUser.email || 'MISSING'}\n\n`

        // Check settings
        const settingsKey = `settings_${USER_ID}`
        const settingsRaw = localStorage.getItem(settingsKey)

        if (!settingsRaw) {
          result += '‚ùå No settings found in localStorage\n'
          result += `   Key: ${settingsKey}\n\n`
        } else {
          result += '‚úÖ Settings found in localStorage\n'

          try {
            const settings = JSON.parse(settingsRaw)
            result += '\nüìã Current Credentials:\n'
            result += '-'.repeat(60) + '\n'
            result += `   API Key: ${settings.retellApiKey || '(empty)'}\n`
            result += `   Call Agent ID: ${settings.callAgentId || '(empty)'}\n`
            result += `   SMS Agent ID: ${settings.smsAgentId || '(empty)'}\n`
            result += `   Tenant ID: ${settings.tenantId || '(not set)'}\n\n`

            // Check if correct
            const isApiKeyCorrect = settings.retellApiKey === CORRECT_CREDENTIALS.retellApiKey
            const isCallAgentCorrect = settings.callAgentId === CORRECT_CREDENTIALS.callAgentId

            result += 'üéØ Correctness Check:\n'
            result += '-'.repeat(60) + '\n'
            result += `   API Key: ${isApiKeyCorrect ? '‚úÖ CORRECT' : '‚ùå WRONG'}\n`
            result += `   Call Agent ID: ${isCallAgentCorrect ? '‚úÖ CORRECT' : '‚ùå WRONG'}\n\n`

            if (isApiKeyCorrect && isCallAgentCorrect) {
              result += 'üéâ ALL CREDENTIALS ARE CORRECT!\n'
              result += '   No fix needed.\n'
            } else {
              result += '‚ö†Ô∏è CREDENTIALS ARE WRONG!\n'
              result += '   Proceed to Step 2 to clear wrong data.\n'
            }
          } catch (parseError) {
            result += `‚ùå Failed to parse settings JSON: ${parseError.message}\n`
          }
        }

        // Check all localStorage keys for debugging
        result += '\nüì¶ All localStorage keys:\n'
        result += '-'.repeat(60) + '\n'
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i)
          if (key && key.includes('settings')) {
            result += `   ${key}\n`
          }
        }

      } catch (error) {
        result += `\n‚ùå Error during diagnosis: ${error.message}\n`
      }

      output.textContent = result
    }

    function clearCredentials() {
      const output = document.getElementById('clearOutput')
      output.classList.remove('hidden')

      let result = 'üóëÔ∏è CLEARING WRONG CREDENTIALS\n'
      result += '=' .repeat(60) + '\n\n'

      try {
        const settingsKey = `settings_${USER_ID}`
        const hadSettings = localStorage.getItem(settingsKey) !== null

        if (hadSettings) {
          localStorage.removeItem(settingsKey)
          result += `‚úÖ Removed settings from localStorage\n`
          result += `   Key: ${settingsKey}\n\n`
          result += '‚úÖ Wrong credentials cleared successfully!\n'
          result += '   Proceed to Step 3 to apply correct credentials.\n'
        } else {
          result += `‚ö†Ô∏è No settings found to clear\n`
          result += `   Key: ${settingsKey}\n\n`
          result += '‚ÑπÔ∏è localStorage already clean.\n'
        }

      } catch (error) {
        result += `\n‚ùå Error clearing credentials: ${error.message}\n`
      }

      output.textContent = result
    }

    function applyCorrectCredentials() {
      const output = document.getElementById('applyOutput')
      output.classList.remove('hidden')

      let result = '‚úÖ APPLYING CORRECT CREDENTIALS\n'
      result += '=' .repeat(60) + '\n\n'

      try {
        const settingsKey = `settings_${USER_ID}`

        // Get existing settings or create new
        let settings = {}
        const existingSettings = localStorage.getItem(settingsKey)
        if (existingSettings) {
          try {
            settings = JSON.parse(existingSettings)
          } catch (e) {
            result += '‚ö†Ô∏è Existing settings were invalid JSON, creating fresh settings\n\n'
          }
        }

        // Apply correct credentials
        settings.retellApiKey = CORRECT_CREDENTIALS.retellApiKey
        settings.callAgentId = CORRECT_CREDENTIALS.callAgentId
        settings.smsAgentId = CORRECT_CREDENTIALS.smsAgentId
        settings.tenantId = CORRECT_CREDENTIALS.tenantId

        // Save to localStorage
        localStorage.setItem(settingsKey, JSON.stringify(settings))

        result += '‚úÖ Correct credentials applied to localStorage!\n\n'
        result += 'üìã Applied Credentials:\n'
        result += '-'.repeat(60) + '\n'
        result += `   API Key: ${settings.retellApiKey}\n`
        result += `   Call Agent ID: ${settings.callAgentId}\n`
        result += `   SMS Agent ID: ${settings.smsAgentId || '(empty)'}\n`
        result += `   Tenant ID: ${settings.tenantId}\n\n`
        result += '‚úÖ FIX COMPLETE!\n'
        result += '   Proceed to Step 4 to verify and reload page.\n'

      } catch (error) {
        result += `\n‚ùå Error applying credentials: ${error.message}\n`
      }

      output.textContent = result
    }

    function verifyFix() {
      const output = document.getElementById('verifyOutput')
      output.classList.remove('hidden')

      let result = 'üîç VERIFICATION REPORT\n'
      result += '=' .repeat(60) + '\n\n'

      try {
        const settingsKey = `settings_${USER_ID}`
        const settingsRaw = localStorage.getItem(settingsKey)

        if (!settingsRaw) {
          result += '‚ùå VERIFICATION FAILED!\n'
          result += '   No settings found in localStorage.\n'
          result += '   Run Step 3 again to apply correct credentials.\n'
        } else {
          const settings = JSON.parse(settingsRaw)

          const isApiKeyCorrect = settings.retellApiKey === CORRECT_CREDENTIALS.retellApiKey
          const isCallAgentCorrect = settings.callAgentId === CORRECT_CREDENTIALS.callAgentId

          result += 'üìã Current Credentials:\n'
          result += '-'.repeat(60) + '\n'
          result += `   API Key: ${isApiKeyCorrect ? '‚úÖ CORRECT' : '‚ùå WRONG'}\n`
          result += `   Call Agent ID: ${isCallAgentCorrect ? '‚úÖ CORRECT' : '‚ùå WRONG'}\n\n`

          if (isApiKeyCorrect && isCallAgentCorrect) {
            result += 'üéâüéâüéâ VERIFICATION PASSED! üéâüéâüéâ\n\n'
            result += '‚úÖ All credentials are correct!\n'
            result += '‚úÖ localStorage has been fixed!\n\n'
            result += 'üìå Next Steps:\n'
            result += '   1. Click "Reload Page" button below\n'
            result += '   2. Go to Settings > API Configuration\n'
            result += '   3. Verify credentials show correctly\n'
            result += '   4. Test Calls and SMS pages\n'
          } else {
            result += '‚ùå VERIFICATION FAILED!\n\n'
            result += '‚ö†Ô∏è Credentials are still wrong.\n'
            result += '   Run Step 2 and Step 3 again.\n'
          }
        }

      } catch (error) {
        result += `\n‚ùå Error during verification: ${error.message}\n`
      }

      output.textContent = result
    }

    function reloadPage() {
      if (confirm('Reload the page now? This will refresh the application with fixed credentials.')) {
        window.location.reload()
      }
    }

    // Auto-diagnose on page load
    window.addEventListener('load', () => {
      setTimeout(diagnoseCredentials, 500)
    })
  </script>
</body>
</html>
