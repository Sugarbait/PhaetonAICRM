<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnose localStorage</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #00ff00;
        }
        h1 {
            color: #00ff00;
            text-align: center;
            margin-bottom: 20px;
        }
        .item {
            margin: 10px 0;
            padding: 10px;
            background: #111;
            border-left: 3px solid #00ff00;
        }
        .key {
            color: #ffff00;
            font-weight: bold;
        }
        .value {
            color: #00ff00;
            margin-left: 20px;
            font-size: 12px;
        }
        button {
            background: #ff0000;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
            font-family: 'Courier New', monospace;
        }
        button:hover {
            background: #cc0000;
        }
        button.go {
            background: #00ff00;
            color: #000;
        }
        button.go:hover {
            background: #00cc00;
        }
        .summary {
            background: #222;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç localStorage DIAGNOSTIC</h1>

        <div id="summary" class="summary"></div>

        <div id="items"></div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="go" onclick="window.location.reload()">üîÑ REFRESH DIAGNOSTIC</button>
            <button onclick="clearSystemUsers()">üóëÔ∏è CLEAR systemUsers</button>
            <button onclick="clearAll()">üí• CLEAR ALL</button>
            <button class="go" onclick="window.location.href='http://localhost:3001'">‚û°Ô∏è GO TO LOGIN</button>
        </div>
    </div>

    <script>
        function displayLocalStorage() {
            const itemsDiv = document.getElementById('items')
            const summaryDiv = document.getElementById('summary')

            const keys = Object.keys(localStorage)
            console.log(`üìä localStorage has ${keys.length} items`)

            // Look for user-related keys
            const userKeys = keys.filter(k =>
                k.includes('user') ||
                k.includes('User') ||
                k.includes('system') ||
                k.includes('System')
            )

            summaryDiv.innerHTML = `
                <strong>üìä SUMMARY</strong><br>
                Total items: ${keys.length}<br>
                User-related keys: ${userKeys.length}<br>
                <br>
                <strong>User-related keys:</strong><br>
                ${userKeys.map(k => `- ${k}`).join('<br>') || 'None'}
            `

            itemsDiv.innerHTML = ''

            keys.forEach(key => {
                const value = localStorage.getItem(key)
                let displayValue = value

                // Try to parse JSON for better display
                try {
                    const parsed = JSON.parse(value)
                    displayValue = JSON.stringify(parsed, null, 2)
                } catch (e) {
                    // Not JSON, just display as-is
                }

                // Truncate long values
                if (displayValue.length > 500) {
                    displayValue = displayValue.substring(0, 500) + '...[truncated]'
                }

                const itemDiv = document.createElement('div')
                itemDiv.className = 'item'
                itemDiv.innerHTML = `
                    <div class="key">${key}</div>
                    <pre class="value">${displayValue}</pre>
                `
                itemsDiv.appendChild(itemDiv)
            })
        }

        function clearSystemUsers() {
            const systemUsers = localStorage.getItem('systemUsers')
            if (systemUsers) {
                console.log('Found systemUsers:', systemUsers)
                localStorage.removeItem('systemUsers')
                alert('‚úÖ systemUsers cleared! Refreshing...')
                window.location.reload()
            } else {
                alert('‚ÑπÔ∏è No systemUsers found')
            }
        }

        function clearAll() {
            const count = Object.keys(localStorage).length
            localStorage.clear()
            sessionStorage.clear()
            alert(`‚úÖ Cleared ALL ${count} items! Refreshing...`)
            window.location.reload()
        }

        // Display on load
        window.addEventListener('load', displayLocalStorage)
    </script>
</body>
</html>
