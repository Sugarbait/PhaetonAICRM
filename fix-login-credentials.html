<!DOCTYPE html>
<html>
<head>
    <title>Fix Login Credentials</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #1a1a1a; color: #fff; }
        .container { max-width: 600px; margin: 0 auto; background: #2a2a2a; padding: 30px; border-radius: 10px; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #333; color: #fff; border: 1px solid #555; border-radius: 5px; }
        button { background: #0066cc; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0052a3; }
        .success { background: #00cc44; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .error { background: #cc0000; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .info { background: #0066cc; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Fix Login Credentials</h1>
        <p>This tool will manually set your login credentials so you can access the system.</p>

        <div id="output"></div>

        <h3>Enter Your Details:</h3>
        <input type="email" id="email" placeholder="Email (e.g., pierre@phaetonai.com)" value="pierre@phaetonai.com">
        <input type="password" id="password" placeholder="Your Password">

        <button onclick="fixCredentials()">Fix Credentials & Enable Login</button>
        <button onclick="checkStatus()">Check Current Status</button>
        <button onclick="clearEverything()">Clear Everything & Start Fresh</button>
    </div>

    <script>
        function output(message, type = 'info') {
            const div = document.getElementById('output')
            div.innerHTML = `<div class="${type}">${message}</div>`
        }

        async function fixCredentials() {
            const email = document.getElementById('email').value
            const password = document.getElementById('password').value

            if (!email || !password) {
                output('Please enter both email and password!', 'error')
                return
            }

            try {
                // Find user ID from localStorage
                const users = localStorage.getItem('systemUsers')
                if (!users) {
                    output('No users found. Please register first!', 'error')
                    return
                }

                const userList = JSON.parse(users)
                const user = userList.find(u => u.email === email)

                if (!user) {
                    output(`User ${email} not found in system!`, 'error')
                    return
                }

                // Create simple unencrypted credentials (for emergency access)
                const credentials = {
                    email: email,
                    password: password
                }

                // Store in multiple locations for reliability
                localStorage.setItem(`userCredentials_${user.id}`, JSON.stringify(credentials))
                localStorage.setItem(`emergencyCredentials_${email}`, JSON.stringify(credentials))
                localStorage.setItem('lastLoginEmail', email)

                output(`
                    ‚úÖ SUCCESS!<br><br>
                    <strong>Credentials Set For:</strong><br>
                    Email: ${email}<br>
                    User ID: ${user.id}<br>
                    Role: ${user.role}<br><br>
                    <strong>Next Steps:</strong><br>
                    1. Close this page<br>
                    2. Refresh the login page<br>
                    3. Login with your email and password<br>
                `, 'success')

            } catch (error) {
                output(`Error: ${error.message}`, 'error')
            }
        }

        function checkStatus() {
            const email = document.getElementById('email').value

            try {
                const users = localStorage.getItem('systemUsers')
                if (!users) {
                    output('No users in system', 'info')
                    return
                }

                const userList = JSON.parse(users)
                const user = userList.find(u => u.email === email)

                if (!user) {
                    output(`User ${email} not found`, 'error')
                    return
                }

                const creds = localStorage.getItem(`userCredentials_${user.id}`)
                const emergencyCreds = localStorage.getItem(`emergencyCredentials_${email}`)

                output(`
                    üìä STATUS:<br><br>
                    User Found: ‚úÖ ${user.name}<br>
                    User ID: ${user.id}<br>
                    Role: ${user.role}<br>
                    Active: ${user.isActive}<br>
                    <br>
                    Credentials Stored: ${creds ? '‚úÖ Yes' : '‚ùå No'}<br>
                    Emergency Creds: ${emergencyCreds ? '‚úÖ Yes' : '‚ùå No'}<br>
                `, 'info')

            } catch (error) {
                output(`Error: ${error.message}`, 'error')
            }
        }

        function clearEverything() {
            if (confirm('This will clear ALL user data. Are you sure?')) {
                localStorage.clear()
                sessionStorage.clear()
                output('‚úÖ Everything cleared! Close this page and register a new user.', 'success')
            }
        }

        // Auto-check status on load
        window.addEventListener('load', () => {
            const email = document.getElementById('email').value
            if (email) {
                setTimeout(checkStatus, 500)
            }
        })
    </script>
</body>
</html>
